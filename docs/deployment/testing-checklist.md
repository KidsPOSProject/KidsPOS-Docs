# KidsPOS システム動作確認チェックリスト

## 概要
KidsPOSシステムの現場展開後に実施する包括的な動作確認手順です。

## 🔧 事前準備

### 確認環境
- [ ] サーバー環境が正常に起動している
- [ ] すべてのAndroid端末が準備されている
- [ ] ネットワーク環境が構築されている
- [ ] テスト用データが準備されている

### テストツール
- [ ] ADBコマンドが使用可能
- [ ] ネットワーク診断ツールが利用可能
- [ ] ログ監視環境が準備されている

## 🖥️ サーバー側テスト

### 1. サーバー起動確認
```bash
# プロセス確認
pm2 status

# ヘルスチェック
curl http://localhost:3000/health

# ポート確認
sudo netstat -tlnp | grep :3000
```
- [ ] PM2でサーバーが「online」状態
- [ ] ヘルスチェックが正常応答（200 OK）
- [ ] ポート3000が正常にリッスン中

### 2. データベース接続確認
```bash
# MongoDB接続テスト
mongo --eval "db.adminCommand('ismaster')"

# データベース確認
mongo kidspos --eval "db.stats()"
```
- [ ] MongoDBサービスが稼働中
- [ ] データベース接続が正常
- [ ] 必要なコレクションが存在

### 3. API動作確認
```bash
# 基本API確認
curl -X GET http://localhost:3000/api/status
curl -X GET http://localhost:3000/api/version

# 認証API確認
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"test"}'
```
- [ ] ステータスAPIが正常応答
- [ ] バージョンAPIが正常応答
- [ ] 認証APIが正常動作

## 📱 Android端末テスト

### 1. 基本動作確認
```bash
# デバイス接続確認
adb devices

# アプリインストール確認
adb shell pm list packages | grep kidspos

# アプリ起動確認
adb shell am start -n com.kidspos.android/.MainActivity
```
- [ ] ADBでデバイス認識
- [ ] KidsPOSアプリがインストール済み
- [ ] アプリが正常起動

### 2. 権限確認
```bash
# カメラ権限確認
adb shell dumpsys package com.kidspos.android | grep CAMERA

# ストレージ権限確認
adb shell dumpsys package com.kidspos.android | grep STORAGE

# ネットワーク権限確認
adb shell dumpsys package com.kidspos.android | grep INTERNET
```
- [ ] カメラ権限が付与されている
- [ ] ストレージ権限が付与されている
- [ ] インターネット権限が付与されている

### 3. サーバー接続テスト
```bash
# ネットワーク疎通確認
adb shell ping -c 3 [サーバーIP]

# ポート接続確認
adb shell nc -zv [サーバーIP] 3000

# アプリからの接続確認
adb logcat | grep KidsPOS
```
- [ ] サーバーへのping応答正常
- [ ] ポート3000への接続成功
- [ ] アプリからサーバーへの接続成功

## 🔍 機能テスト

### 1. QRコード読み取りテスト
- [ ] カメラが正常に起動する
- [ ] QRコードが正確に読み取れる
- [ ] 読み取り結果が表示される
- [ ] 音声フィードバックが機能する
- [ ] エラー時の処理が適切

### 2. データ送信テスト
- [ ] 読み取りデータがサーバーに送信される
- [ ] 送信成功の確認メッセージが表示される
- [ ] データがデータベースに正しく保存される
- [ ] エラー時の再送機能が動作する

### 3. 同期機能テスト
- [ ] オンライン状態でのリアルタイム同期
- [ ] オフライン状態でのローカル保存
- [ ] 復旧時の自動同期
- [ ] 重複データの適切な処理

## 🌐 ネットワークテスト

### 1. 接続安定性テスト
```bash
# 継続ping テスト
ping -i 1 -c 100 [サーバーIP]

# 帯域幅テスト
iperf3 -c [サーバーIP] -t 60

# パケットロステスト
mtr -r -c 10 [サーバーIP]
```
- [ ] パケットロス率 < 1%
- [ ] 平均遅延 < 50ms
- [ ] 帯域幅が要件を満たす

### 2. 負荷テスト
- [ ] 複数端末同時接続テスト（最大予定台数）
- [ ] 同時QRコード読み取りテスト
- [ ] 大量データ送信テスト
- [ ] ピーク時間帯の動作確認

### 3. WiFi接続テスト
```bash
# WiFi信号強度確認
adb shell dumpsys wifi | grep RSSI

# 接続履歴確認
adb shell dumpsys wifi | grep "Connection events"
```
- [ ] 信号強度が十分（-70dBm以上）
- [ ] 接続の安定性
- [ ] 自動再接続機能

## 🚀 パフォーマンステスト

### 1. サーバーパフォーマンス
```bash
# CPU使用率監視
top -p $(pgrep -f kidspos-server)

# メモリ使用量確認
ps aux | grep kidspos-server

# レスポンス時間測定
ab -n 100 -c 10 http://localhost:3000/api/status
```
- [ ] CPU使用率 < 80%
- [ ] メモリ使用量 < 1GB
- [ ] 平均レスポンス時間 < 2秒

### 2. Android端末パフォーマンス
```bash
# メモリ使用量確認
adb shell dumpsys meminfo com.kidspos.android

# CPU使用率確認
adb shell top | grep kidspos

# バッテリー使用量確認
adb shell dumpsys battery
```
- [ ] メモリ使用量が適切
- [ ] CPU使用率 < 30%
- [ ] バッテリー消費が正常範囲

## 🔒 セキュリティテスト

### 1. ネットワークセキュリティ
```bash
# ポートスキャン
nmap -sT [サーバーIP]

# ファイアウォール確認
sudo ufw status verbose

# SSL/TLS確認（HTTPS使用時）
openssl s_client -connect [サーバーIP]:443
```
- [ ] 不要ポートが閉じられている
- [ ] ファイアウォールが適切に設定
- [ ] SSL証明書が有効（HTTPS使用時）

### 2. 認証・認可テスト
- [ ] 不正なアクセスが拒否される
- [ ] セッション管理が適切
- [ ] パスワードポリシーが守られている
- [ ] 権限管理が正常動作

## 📊 データ整合性テスト

### 1. データ保存確認
```bash
# データベース内容確認
mongo kidspos --eval "db.transactions.find().count()"

# ログファイル確認
tail -f ~/.pm2/logs/kidspos-server-out.log
```
- [ ] データが正確に保存されている
- [ ] データ形式が正しい
- [ ] タイムスタンプが正確
- [ ] 重複データがない

### 2. バックアップ・復旧テスト
```bash
# バックアップ作成
mongodump --db kidspos --out /backup/test

# 復旧テスト
mongorestore --db kidspos_test /backup/test/kidspos
```
- [ ] バックアップが正常作成される
- [ ] 復旧が正常実行される
- [ ] データの整合性が保たれる

## 🚨 障害シミュレーションテスト

### 1. ネットワーク障害テスト
- [ ] WiFi切断時の動作確認
- [ ] サーバー停止時の動作確認
- [ ] 復旧時の自動再接続確認
- [ ] オフラインデータの同期確認

### 2. システム障害テスト
- [ ] サーバー再起動時の動作
- [ ] データベース停止時の動作
- [ ] 電源断時の動作
- [ ] アプリクラッシュ時の復旧

## 👥 ユーザビリティテスト

### 1. 操作性確認
- [ ] 直感的な操作が可能
- [ ] エラーメッセージが分かりやすい
- [ ] レスポンスが適切
- [ ] 画面遷移がスムーズ

### 2. アクセシビリティ確認
- [ ] 文字サイズが適切
- [ ] コントラストが十分
- [ ] 音声フィードバックが明確
- [ ] 操作が簡単

## 📋 最終確認チェックリスト

### システム全体
- [ ] 全コンポーネントが正常動作
- [ ] パフォーマンス要件を満たす
- [ ] セキュリティ要件を満たす
- [ ] データ整合性が保たれる
- [ ] 障害時の対応が適切

### 運用準備
- [ ] 監視システムが設定済み
- [ ] ログ管理が適切
- [ ] バックアップが設定済み  
- [ ] 運用手順書が準備済み
- [ ] 緊急時連絡体制が確立

### スタッフ準備
- [ ] 操作研修が完了
- [ ] トラブルシューティング手順の理解
- [ ] 緊急時対応の理解
- [ ] 連絡体制の把握

## 📝 テスト結果記録

### 記録項目
- **テスト実施日時**: ___________
- **テスト実施者**: ___________
- **環境情報**: ___________
- **問題発生項目**: ___________
- **解決済み項目**: ___________
- **未解決項目**: ___________

### 承認
- **技術責任者承認**: ___________
- **運用責任者承認**: ___________
- **最終承認**: ___________

---

**このチェックリストに基づいて段階的にテストを実施し、**
**すべての項目をクリアしてから本格運用を開始してください。**